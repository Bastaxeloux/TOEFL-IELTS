<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Speaking Practice</title>
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <div class="header-logo-container">
            <img src="{{ url_for('static', filename='favicon.png') }}" alt="IELTS Logo" class="page-logo">
        </div>
        <h1>IELTS Speaking Practice</h1>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button id="practiceTab" class="tab-btn active">Practice</button>
            <button id="promptsTab" class="tab-btn">Manage Prompts</button>
        </div>

        <!-- Practice Tab -->
        <div id="practiceContent" class="tab-content active">
            <div class="task-instructions">
                <p><strong>IELTS Speaking Test Format:</strong></p>
                <p><strong>Part 1:</strong> Introduction & Interview (4-5 minutes) - Multiple short questions</p>
                <p><strong>Part 2:</strong> Long Turn / Cue Card (3-4 minutes, including 1 min preparation)</p>
                <p><strong>Part 3:</strong> Discussion (4-5 minutes)</p>
                <p style="margin-top: 15px; color: #666;"><em>For Part 1: Start recording, answer the first question, click "Next Question" to move to the next one while still recording.</em></p>
            </div>

            <div class="config-section">
                <div class="config-item">
                    <label for="partSelect">Select Speaking Part:</label>
                    <select id="partSelect" style="width: 100%; padding: 10px; border: 1px solid #ddd;">
                        <option value="1">Part 1: Introduction & Interview</option>
                        <option value="2">Part 2: Long Turn (Cue Card)</option>
                        <option value="3">Part 3: Discussion</option>
                    </select>
                </div>

                <div class="config-item">
                    <label for="apiKey">OpenAI API Key:</label>
                    <div class="api-key-input-group">
                        <input type="password" id="apiKey" placeholder="sk-..." value="{{ api_key }}">
                        <button id="saveApiKeyBtn" class="btn btn-success btn-compact">Save</button>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button id="startPractice" class="btn btn-primary btn-highlight">Start Practice</button>
                <button onclick="window.location.href='/'" class="btn btn-secondary">Back to Home</button>
            </div>

            <!-- Practice Area (hidden initially) -->
            <div id="practiceArea" style="display: none;">
                <div class="current-prompt">
                    <h3>Question:</h3>
                    <div id="questionText" style="font-size: 17px; line-height: 1.6; padding: 15px; background: white; border: 1px solid #ddd;"></div>
                </div>

                <!-- Timer -->
                <div class="timer-container">
                    <div class="timer">
                        <span id="timerValue">0</span>
                    </div>
                    <div class="timer-label" id="timerLabel">Preparation Time</div>
                </div>

                <!-- Recording Controls -->
                <div class="button-container">
                    <button id="startRecording" class="btn btn-danger">Start Recording</button>
                    <button id="stopRecording" class="btn btn-warning" disabled>Stop Recording</button>
                    <button id="nextQuestionBtn" class="btn btn-primary" style="display: none;">Next Question</button>
                </div>

                <div class="recording-indicator" id="recordingIndicator">Recording...</div>

                <!-- Recorded Audio -->
                <div id="audioContainer" style="text-align: center; margin: 20px 0;"></div>

                <!-- Transcription -->
                <div id="transcriptionContainer" style="display: none;" class="transcription-container">
                    <h3>Transcription:</h3>
                    <div id="transcriptionText"></div>
                    <p><strong>Word count:</strong> <span id="wordCount">0</span></p>
                </div>

                <!-- AI Feedback -->
                <div id="feedbackContainer" style="display: none;" class="ai-feedback">
                    <h3>AI Feedback</h3>
                    <div id="feedbackContent" class="feedback-card"></div>
                </div>

                <!-- Action Buttons -->
                <div class="button-container">
                    <button id="getTranscript" class="btn btn-primary" style="display: none;">Get Transcript</button>
                    <button id="getEvaluation" class="btn btn-success" style="display: none;">Get AI Evaluation</button>
                    <button id="addToVocab" class="btn btn-secondary" style="display: none;">Add to Vocabulary</button>
                    <button id="newQuestion" class="btn btn-primary" style="display: none;">New Question</button>
                </div>
            </div>
        </div>

        <!-- Prompts Management Tab -->
        <div id="promptsContent" class="tab-content">
            <div class="config-section">
                <h3>Add New Speaking Prompt</h3>
                <div class="config-item">
                    <label for="newPromptPart">Speaking Part:</label>
                    <select id="newPromptPart" style="width: 100%; padding: 10px; border: 1px solid #ddd;">
                        <option value="1">Part 1</option>
                        <option value="2">Part 2</option>
                        <option value="3">Part 3</option>
                    </select>
                </div>
                <div class="config-item">
                    <label for="newPromptQuestion">Question:</label>
                    <textarea id="newPromptQuestion" rows="6" style="width: 100%; padding: 10px; border: 2px solid #333;" placeholder="For Part 1: Enter multiple questions (one per line, minimum 3 questions)&#10;For Part 2/3: Enter a single question or topic"></textarea>
                    <span class="config-hint">Part 1 requires at least 3 questions, one per line</span>
                </div>
                <div class="button-container">
                    <button id="addPrompt" class="btn btn-success">Add Prompt</button>
                </div>
            </div>

            <div class="config-section" style="margin-top: 30px;">
                <h3>Existing Prompts</h3>
                <div id="promptsList"></div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='speaking.js') }}"></script>
</body>
</html>
